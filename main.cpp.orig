#include "colors.h"
#include "contours.h"
#include "arena.h"
#include "ball.h"


main(int argc,char** argv)
{
	VideoCapture cap;
	int f=0;
	
	cap.open(argv[1]);
	if(!cap.isOpened())
	{
		printf("\nCamera is not initialised properly, Aborting...\n");
	}
	
	Mat src_image = Mat::zeros(cap.get(4),cap.get(3),CV_8U);
    Mat orange_mask = Mat::zeros(cap.get(4),cap.get(3),CV_8U);
    Mat green_mask = Mat::zeros(cap.get(4),cap.get(3),CV_8U);

//	Mat dst = Mat::zeros(800,600,CV_8UC3);
//	Mat warp = Mat::zeros(640,480,CV_8UC3);
//	Point2f* pts;
//	pts = new Point2f [4];
//	ball oball = ball();
	while(1)
	{
		
		cap>>src_image;
    cvtColor(src_image,src_image,CV_BGR2HSV);

    pick_color(src_image, orange_mask, 'g');
    pick_color(src_image, green_mask, 'g');

        imshow("image",src_image);
        imshow("green_mask",green_mask);
        imshow("orange_mask",orange_mask);

		if(waitKey(5)==27)
		break;		

		resize(src_image,dst,Size(800,600));
		 if(f==1)
		{
			warp = perspectiveArena(dst,pts);
			imshow("warp",warp);
			oball.init(warp);
		}
		else if(f==0)
		{
			pts = selectPoint(dst);		
			
			f=1;
		}
		
		//warp.convertTo(warp,CV_8UC3,255);
		imshow("src",dst);
		
		
		
		if(waitKey(20)==27)
		break;
		
	}
//	delete pts;
	destroyAllWindows();
	cap.release();
}	
	
